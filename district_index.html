<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ì „êµ­ êµ¬ë³„ ì•„íŒŒíŠ¸ í‰ë‹¹ê°€ TOP 10</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans KR',sans-serif;background:#000;color:#fff;min-height:100vh;padding:40px 20px}
.container{max-width:1200px;margin:0 auto}
h1{font-size:2rem;font-weight:700;margin-bottom:8px;letter-spacing:-0.5px}
.subtitle{color:#888;font-size:0.9rem;margin-bottom:24px}

/* Tabs */
.tab-section{background:#1a1a1a;border-radius:12px;padding:20px;margin-bottom:16px}
.tab-group-label{font-size:0.7rem;color:#555;margin-bottom:6px;letter-spacing:1px}
.tab-row{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:14px}
.tab-row:last-child{margin-bottom:0}
.tab{padding:7px 14px;border-radius:8px;font-size:0.82rem;cursor:pointer;border:1px solid #2a2a35;background:#111;color:#888;transition:all 0.2s;user-select:none;font-family:inherit}
.tab:hover{background:#222;color:#ccc}
.tab.active{background:#00d4aa;color:#000;font-weight:700;border-color:#00d4aa}

/* Dropdown */
.dropdown-area{display:flex;align-items:center;gap:14px;margin-bottom:20px}
.dropdown-label{color:#888;font-size:0.85rem;white-space:nowrap}
.dropdown-select{flex:1;max-width:280px;padding:10px 40px 10px 16px;border-radius:10px;background:#1a1a1a;border:1px solid #333;color:#fff;font-size:0.9rem;font-family:inherit;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23888' fill='none' stroke-width='2'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;cursor:pointer}
.dropdown-select:focus{outline:none;border-color:#00d4aa}

/* Cards */
.insight-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px}
.insight-card{background:#1a1a1a;border-radius:12px;padding:18px}
.insight-card .label{color:#888;font-size:0.78rem;margin-bottom:6px}
.insight-card .value{font-size:1.2rem;font-weight:700}

/* Chart */
.chart-section{background:#1a1a1a;border-radius:12px;padding:24px;margin-bottom:20px}
.chart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:10px}
.chart-title{font-size:0.95rem;font-weight:700}
.chart-hint{font-size:0.78rem;color:#555;margin-top:8px;text-align:center}
.toggle-btns{display:flex;gap:4px}
.toggle-btn{background:#333;border:none;color:#aaa;padding:6px 14px;border-radius:8px;cursor:pointer;font-size:0.8rem;font-family:inherit;transition:all 0.2s}
.toggle-btn.active{background:#00d4aa;color:#000}
.chart-canvas-wrap{width:100%;height:200px;position:relative}
.chart-canvas-wrap canvas{width:100%!important;height:100%!important}
.selected-label{position:absolute;top:8px;left:12px;font-size:0.85rem;font-weight:700;opacity:0;transition:opacity 0.3s;pointer-events:none}
.selected-label.show{opacity:1}

/* Table */
table.main-table{width:100%;border-collapse:collapse}
table.main-table thead th{text-align:left;padding:14px 10px;border-bottom:2px solid #333;font-weight:500;color:#aaa;font-size:0.82rem}
table.main-table thead th:last-child{text-align:right}
.main-row{cursor:pointer;transition:background 0.25s,opacity 0.25s}
.main-row:hover{background:#1a1a1a}
.main-row td{padding:14px 10px;border-bottom:1px solid #222;font-size:0.93rem}
.main-row.active-row{background:rgba(0,212,170,0.08)}
.main-row.dimmed{opacity:0.35}
.color-dot{display:inline-block;width:9px;height:9px;border-radius:50%;margin-right:8px;vertical-align:middle}
.rank-cell{font-weight:700;color:#666;width:36px}
.apt-name{font-weight:500}
.loc-cell{color:#aaa;font-size:0.85rem}
.arrow{color:#555;font-size:0.7rem;margin-left:6px;transition:transform 0.2s;display:inline-block}
.arrow.open{transform:rotate(180deg)}
.price{text-align:right;font-weight:700;color:#00d4aa;font-variant-numeric:tabular-nums}
.detail-row{display:none}
.detail-row.show{display:table-row}
.detail-row td{padding:0;background:#0d0d0d;border-bottom:1px solid #222}
.detail-content{padding:16px 10px 16px 46px;display:flex;gap:24px;align-items:flex-start}
.detail-info{flex:1}
.detail-table{width:100%;max-width:350px}
.detail-table th{text-align:left;padding:6px 14px 6px 0;color:#666;font-weight:400;font-size:0.85rem;width:80px}
.detail-table td{padding:6px 0;font-size:0.9rem;color:#ccc}
.empty-msg{text-align:center;padding:60px 20px;color:#555;font-size:0.95rem}

.footer{margin-top:40px;padding-top:20px;border-top:1px solid #222;color:#555;font-size:0.8rem;text-align:center}
@media(max-width:768px){.insight-cards{grid-template-columns:1fr 1fr 1fr}.tab{padding:6px 10px;font-size:0.75rem}}
@media(max-width:600px){body{padding:20px 12px}h1{font-size:1.4rem}.insight-cards{grid-template-columns:1fr}.chart-canvas-wrap{height:180px}.detail-content{flex-direction:column;padding:12px 8px 12px 16px;gap:12px}.main-row td{padding:10px 6px;font-size:0.85rem}}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ  ì „êµ­ êµ¬ë³„ ì•„íŒŒíŠ¸ í‰ë‹¹ê°€ TOP 10</h1>
<p class="subtitle">ìµœê·¼ 6ê°œì›” ì‹¤ê±°ë˜ ê¸°ì¤€ Â· ì „ìš©ë©´ì  59ã¡ ì´ìƒ Â· ë‹¨ì§€ë³„ ìµœê³ ê°€</p>

<!-- Tabs -->
<div class="tab-section">
<div class="tab-group-label">íŠ¹ë³„ì‹œ Â· ê´‘ì—­ì‹œ Â· íŠ¹ë³„ìì¹˜ì‹œ</div>
<div class="tab-row" id="metroTabs"></div>
<div class="tab-group-label">ë„</div>
<div class="tab-row" id="provTabs"></div>
</div>

<!-- Dropdown -->
<div class="dropdown-area">
<div class="dropdown-label">ì§€ì—­ ì„ íƒ</div>
<select class="dropdown-select" id="districtSelect" onchange="onDistrictChange()"></select>
</div>

<!-- Insight Cards -->
<div class="insight-cards" id="insightCards">
<div class="insight-card"><div class="label" id="cardLabel1">TOP 10 í‰ê·  í‰ë‹¹ê°€</div><div class="value" id="cardVal1" style="color:#00d4aa;">-</div></div>
<div class="insight-card"><div class="label">ìµœê³ ê°€ ë‹¨ì§€</div><div class="value" id="cardVal2" style="font-size:1rem;">-</div></div>
<div class="insight-card"><div class="label">ê±°ë˜ ê±´ìˆ˜ (6ê°œì›”)</div><div class="value" id="cardVal3">-</div></div>
</div>

<!-- Chart -->
<div class="chart-section" id="chartSection">
<div class="chart-header">
<span class="chart-title" id="chartTitle">ğŸ“ˆ í‰ë‹¹ê°€ ì¶”ì´</span>
<div class="toggle-btns">
<button class="toggle-btn" onclick="setRange(12)" id="btn-1y">1ë…„</button>
<button class="toggle-btn" onclick="setRange(24)" id="btn-2y">2ë…„</button>
<button class="toggle-btn active" onclick="setRange(36)" id="btn-3y">3ë…„</button>
</div>
</div>
<div class="chart-canvas-wrap">
<div class="selected-label" id="selectedLabel"></div>
<canvas id="trendChart"></canvas>
</div>
<div class="chart-hint">ğŸ‘† ì•„ë˜ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì•„íŒŒíŠ¸ë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ ì¶”ì´ê°€ ê°•ì¡°ë©ë‹ˆë‹¤</div>
</div>

<!-- Table -->
<table class="main-table">
<thead><tr><th>ìˆœìœ„</th><th>ë‹¨ì§€ëª…</th><th>ë™</th><th style="text-align:right;">í‰ë‹¹ê°€</th></tr></thead>
<tbody id="tableBody"></tbody>
</table>

<div class="footer" id="footerText">ë°ì´í„° ì¶œì²˜: êµ­í† êµí†µë¶€ ì‹¤ê±°ë˜ê°€ ê³µê°œì‹œìŠ¤í…œ</div>
</div>

<script>
/* â”€â”€ ì§€ì—­ ë§¤í•‘ â”€â”€ */
const REGION_MAP = {
"ì„œìš¸ì‹œ":["ì¢…ë¡œêµ¬","ì¤‘êµ¬","ìš©ì‚°êµ¬","ì„±ë™êµ¬","ê´‘ì§„êµ¬","ë™ëŒ€ë¬¸êµ¬","ì¤‘ë‘êµ¬","ì„±ë¶êµ¬","ê°•ë¶êµ¬","ë„ë´‰êµ¬","ë…¸ì›êµ¬","ì€í‰êµ¬","ì„œëŒ€ë¬¸êµ¬","ë§ˆí¬êµ¬","ì–‘ì²œêµ¬","ê°•ì„œêµ¬","êµ¬ë¡œêµ¬","ê¸ˆì²œêµ¬","ì˜ë“±í¬êµ¬","ë™ì‘êµ¬","ê´€ì•…êµ¬","ì„œì´ˆêµ¬","ê°•ë‚¨êµ¬","ì†¡íŒŒêµ¬","ê°•ë™êµ¬"],
"ì¸ì²œì‹œ":["ì¤‘êµ¬","ë™êµ¬","ë¯¸ì¶”í™€êµ¬","ì—°ìˆ˜êµ¬","ë‚¨ë™êµ¬","ë¶€í‰êµ¬","ê³„ì–‘êµ¬","ì„œêµ¬","ê°•í™”êµ°","ì˜¹ì§„êµ°"],
"ë¶€ì‚°ì‹œ":["ì¤‘êµ¬","ì„œêµ¬","ë™êµ¬","ì˜ë„êµ¬","ë¶€ì‚°ì§„êµ¬","ë™ë˜êµ¬","ë‚¨êµ¬","ë¶êµ¬","í•´ìš´ëŒ€êµ¬","ì‚¬í•˜êµ¬","ê¸ˆì •êµ¬","ê°•ì„œêµ¬","ì—°ì œêµ¬","ìˆ˜ì˜êµ¬","ì‚¬ìƒêµ¬","ê¸°ì¥êµ°"],
"ëŒ€êµ¬ì‹œ":["ì¤‘êµ¬","ë™êµ¬","ì„œêµ¬","ë‚¨êµ¬","ë¶êµ¬","ìˆ˜ì„±êµ¬","ë‹¬ì„œêµ¬","ë‹¬ì„±êµ°","êµ°ìœ„êµ°"],
"ê´‘ì£¼ì‹œ":["ë™êµ¬","ì„œêµ¬","ë‚¨êµ¬","ë¶êµ¬","ê´‘ì‚°êµ¬"],
"ëŒ€ì „ì‹œ":["ë™êµ¬","ì¤‘êµ¬","ì„œêµ¬","ìœ ì„±êµ¬","ëŒ€ë•êµ¬"],
"ìš¸ì‚°ì‹œ":["ì¤‘êµ¬","ë‚¨êµ¬","ë™êµ¬","ë¶êµ¬","ìš¸ì£¼êµ°"],
"ì„¸ì¢…ì‹œ":["ì„¸ì¢…ì‹œ"],
"ê²½ê¸°ë„":["ìˆ˜ì›ì‹œ ì¥ì•ˆêµ¬","ìˆ˜ì›ì‹œ ê¶Œì„ êµ¬","ìˆ˜ì›ì‹œ íŒ”ë‹¬êµ¬","ìˆ˜ì›ì‹œ ì˜í†µêµ¬","ì„±ë‚¨ì‹œ ìˆ˜ì •êµ¬","ì„±ë‚¨ì‹œ ì¤‘ì›êµ¬","ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬","ì˜ì •ë¶€ì‹œ","ì•ˆì–‘ì‹œ ë§Œì•ˆêµ¬","ì•ˆì–‘ì‹œ ë™ì•ˆêµ¬","ë¶€ì²œì‹œ","ê´‘ëª…ì‹œ","í‰íƒì‹œ","ë™ë‘ì²œì‹œ","ì•ˆì‚°ì‹œ ìƒë¡êµ¬","ì•ˆì‚°ì‹œ ë‹¨ì›êµ¬","ê³ ì–‘ì‹œ ë•ì–‘êµ¬","ê³ ì–‘ì‹œ ì¼ì‚°ë™êµ¬","ê³ ì–‘ì‹œ ì¼ì‚°ì„œêµ¬","ê³¼ì²œì‹œ","êµ¬ë¦¬ì‹œ","ë‚¨ì–‘ì£¼ì‹œ","ì˜¤ì‚°ì‹œ","ì‹œí¥ì‹œ","êµ°í¬ì‹œ","ì˜ì™•ì‹œ","í•˜ë‚¨ì‹œ","ìš©ì¸ì‹œ ì²˜ì¸êµ¬","ìš©ì¸ì‹œ ê¸°í¥êµ¬","ìš©ì¸ì‹œ ìˆ˜ì§€êµ¬","íŒŒì£¼ì‹œ","ì´ì²œì‹œ","ì•ˆì„±ì‹œ","ê¹€í¬ì‹œ","í™”ì„±ì‹œ","ê´‘ì£¼ì‹œ","ì–‘ì£¼ì‹œ","í¬ì²œì‹œ","ì—¬ì£¼ì‹œ","ì—°ì²œêµ°","ê°€í‰êµ°","ì–‘í‰êµ°"],
"ê°•ì›ë„":["ì¶˜ì²œì‹œ","ì›ì£¼ì‹œ","ê°•ë¦‰ì‹œ","ë™í•´ì‹œ","íƒœë°±ì‹œ","ì†ì´ˆì‹œ","ì‚¼ì²™ì‹œ","í™ì²œêµ°","íš¡ì„±êµ°","ì˜ì›”êµ°","í‰ì°½êµ°","ì •ì„ êµ°","ì² ì›êµ°","í™”ì²œêµ°","ì–‘êµ¬êµ°","ì¸ì œêµ°","ê³ ì„±êµ°","ì–‘ì–‘êµ°"],
"ì¶©ë¶":["ì²­ì£¼ì‹œ ìƒë‹¹êµ¬","ì²­ì£¼ì‹œ ì„œì›êµ¬","ì²­ì£¼ì‹œ í¥ë•êµ¬","ì²­ì£¼ì‹œ ì²­ì›êµ¬","ì¶©ì£¼ì‹œ","ì œì²œì‹œ","ë³´ì€êµ°","ì˜¥ì²œêµ°","ì˜ë™êµ°","ì¦í‰êµ°","ì§„ì²œêµ°","ê´´ì‚°êµ°","ìŒì„±êµ°","ë‹¨ì–‘êµ°"],
"ì¶©ë‚¨":["ì²œì•ˆì‹œ ë™ë‚¨êµ¬","ì²œì•ˆì‹œ ì„œë¶êµ¬","ê³µì£¼ì‹œ","ë³´ë ¹ì‹œ","ì•„ì‚°ì‹œ","ì„œì‚°ì‹œ","ë…¼ì‚°ì‹œ","ê³„ë£¡ì‹œ","ë‹¹ì§„ì‹œ","ê¸ˆì‚°êµ°","ë¶€ì—¬êµ°","ì„œì²œêµ°","ì²­ì–‘êµ°","í™ì„±êµ°","ì˜ˆì‚°êµ°","íƒœì•ˆêµ°"],
"ì „ë¶":["ì „ì£¼ì‹œ ì™„ì‚°êµ¬","ì „ì£¼ì‹œ ë•ì§„êµ¬","êµ°ì‚°ì‹œ","ìµì‚°ì‹œ","ì •ìì‹œ","ë‚¨ì›ì‹œ","ê¹€ì œì‹œ","ì™„ì£¼êµ°","ì§„ì•ˆêµ°","ë¬´ì£¼êµ°","ì¥ìˆ˜êµ°","ì„ì‹¤êµ°","ìˆœì°½êµ°","ê³ ì°½êµ°","ë¶€ì•ˆêµ°"],
"ì „ë‚¨":["ëª©í¬ì‹œ","ì—¬ìˆ˜ì‹œ","ìˆœì²œì‹œ","ë‚˜ì£¼ì‹œ","ê´‘ì–‘ì‹œ","ë‹´ì–‘êµ°","ê³¡ì„±êµ°","êµ¬ë¡€êµ°","ê³ í¥êµ°","ë³´ì„±êµ°","í™”ìˆœêµ°","ì¥í¥êµ°","ê°•ì§„êµ°","í•´ë‚¨êµ°","ì˜ì•”êµ°","ë¬´ì•ˆêµ°","í•¨í‰êµ°","ì˜ê´‘êµ°","ì¥ì„±êµ°","ì™„ë„êµ°","ì§„ë„êµ°","ì‹ ì•ˆêµ°"],
"ê²½ë¶":["í¬í•­ì‹œ ë‚¨êµ¬","í¬í•­ì‹œ ë¶êµ¬","ê²½ì£¼ì‹œ","ê¹€ì²œì‹œ","ì•ˆë™ì‹œ","êµ¬ë¯¸ì‹œ","ì˜ì£¼ì‹œ","ì˜ì²œì‹œ","ìƒì£¼ì‹œ","ë¬¸ê²½ì‹œ","ê²½ì‚°ì‹œ","ì˜ì„±êµ°","ì²­ì†¡êµ°","ì˜ì–‘êµ°","ì˜ë•êµ°","ì²­ë„êµ°","ê³ ë ¹êµ°","ì„±ì£¼êµ°","ì¹ ê³¡êµ°","ì˜ˆì²œêµ°","ë´‰í™”êµ°","ìš¸ì§„êµ°","ìš¸ë¦‰êµ°"],
"ê²½ë‚¨":["ì°½ì›ì‹œ ì˜ì°½êµ¬","ì°½ì›ì‹œ ì„±ì‚°êµ¬","ì°½ì›ì‹œ ë§ˆì‚°í•©í¬êµ¬","ì°½ì›ì‹œ ë§ˆì‚°íšŒì›êµ¬","ì°½ì›ì‹œ ì§„í•´êµ¬","ì§„ì£¼ì‹œ","í†µì˜ì‹œ","ì‚¬ì²œì‹œ","ê¹€í•´ì‹œ","ë°€ì–‘ì‹œ","ê±°ì œì‹œ","ì–‘ì‚°ì‹œ","ì˜ë ¹êµ°","í•¨ì•ˆêµ°","ì°½ë…•êµ°","ê³ ì„±êµ°","ë‚¨í•´êµ°","í•˜ë™êµ°","ì‚°ì²­êµ°","í•¨ì–‘êµ°","ê±°ì°½êµ°","í•©ì²œêµ°"],
"ì œì£¼ë„":["ì œì£¼ì‹œ","ì„œê·€í¬ì‹œ"]
};
const METRO = ["ì„œìš¸ì‹œ","ì¸ì²œì‹œ","ë¶€ì‚°ì‹œ","ëŒ€êµ¬ì‹œ","ê´‘ì£¼ì‹œ","ëŒ€ì „ì‹œ","ìš¸ì‚°ì‹œ","ì„¸ì¢…ì‹œ"];
const PROV = ["ê²½ê¸°ë„","ê°•ì›ë„","ì¶©ë¶","ì¶©ë‚¨","ì „ë¶","ì „ë‚¨","ê²½ë¶","ê²½ë‚¨","ì œì£¼ë„"];
const TAB_LABELS = {"ì„œìš¸ì‹œ":"ì„œìš¸","ì¸ì²œì‹œ":"ì¸ì²œ","ë¶€ì‚°ì‹œ":"ë¶€ì‚°","ëŒ€êµ¬ì‹œ":"ëŒ€êµ¬","ê´‘ì£¼ì‹œ":"ê´‘ì£¼","ëŒ€ì „ì‹œ":"ëŒ€ì „","ìš¸ì‚°ì‹œ":"ìš¸ì‚°","ì„¸ì¢…ì‹œ":"ì„¸ì¢…","ê²½ê¸°ë„":"ê²½ê¸°","ê°•ì›ë„":"ê°•ì›","ì¶©ë¶":"ì¶©ë¶","ì¶©ë‚¨":"ì¶©ë‚¨","ì „ë¶":"ì „ë¶","ì „ë‚¨":"ì „ë‚¨","ê²½ë¶":"ê²½ë¶","ê²½ë‚¨":"ê²½ë‚¨","ì œì£¼ë„":"ì œì£¼"};
const COLORS = ["#00d4aa","#4ecdc4","#ff6b6b","#45b7d1","#96ceb4","#ffeaa7","#a29bfe","#fd79a8","#e17055","#74b9ff"];

let DATA = null;
let currentSido = "ì„œìš¸ì‹œ";
let currentDistrict = "ê°•ë‚¨êµ¬";
let chart = null;
let activeIdx = -1;
let currentRange = 36;
let currentLabels = [];
let currentSeries = [];

/* â”€â”€ íƒ­ ìƒì„± â”€â”€ */
function buildTabs() {
    const m = document.getElementById('metroTabs');
    const p = document.getElementById('provTabs');
    METRO.forEach(sido => {
        const t = document.createElement('div');
        t.className = 'tab' + (sido === currentSido ? ' active' : '');
        t.textContent = TAB_LABELS[sido];
        t.onclick = () => selectSido(sido);
        m.appendChild(t);
    });
    PROV.forEach(sido => {
        const t = document.createElement('div');
        t.className = 'tab' + (sido === currentSido ? ' active' : '');
        t.textContent = TAB_LABELS[sido];
        t.onclick = () => selectSido(sido);
        p.appendChild(t);
    });
}

function selectSido(sido) {
    currentSido = sido;
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => {
        if (TAB_LABELS[sido] === t.textContent) t.classList.add('active');
    });
    populateDropdown();
    onDistrictChange();
}

function populateDropdown() {
    const sel = document.getElementById('districtSelect');
    sel.innerHTML = '';
    const districts = REGION_MAP[currentSido] || [];
    districts.forEach(d => {
        const opt = document.createElement('option');
        opt.value = d;
        opt.textContent = d;
        sel.appendChild(opt);
    });
    currentDistrict = districts[0] || '';
}

function onDistrictChange() {
    const sel = document.getElementById('districtSelect');
    currentDistrict = sel.value;
    activeIdx = -1;
    render();
}

/* â”€â”€ ê°€ê²© í¬ë§· â”€â”€ */
function fp(p) {
    const b = Math.floor(p / 10000);
    const r = p % 10000;
    return b > 0 ? b + 'ì–µ ' + r.toLocaleString() + 'ë§Œ' : p.toLocaleString() + 'ë§Œ';
}

/* â”€â”€ ë Œë”ë§ â”€â”€ */
function render() {
    const key = currentSido + '|' + currentDistrict;
    const d = DATA ? DATA.data[key] : null;

    // Cards
    document.getElementById('cardLabel1').textContent = currentDistrict + ' TOP 10 í‰ê· ';
    if (d) {
        document.getElementById('cardVal1').textContent = fp(d.avg);
        document.getElementById('cardVal2').textContent = d.top10[0].name;
        document.getElementById('cardVal3').textContent = d.deals.toLocaleString() + 'ê±´';
    } else {
        document.getElementById('cardVal1').textContent = '-';
        document.getElementById('cardVal2').textContent = '-';
        document.getElementById('cardVal3').textContent = '-';
    }

    // Chart title
    document.getElementById('chartTitle').textContent = 'ğŸ“ˆ ' + currentDistrict + ' TOP 10 í‰ë‹¹ê°€ ì¶”ì´';

    // Store for range toggle
    currentLabels = DATA ? DATA.labels : [];
    currentSeries = d ? d.series : [];

    renderChart();
    renderTable(d);
}

/* â”€â”€ ì°¨íŠ¸ â”€â”€ */
function renderChart() {
    const labels = currentLabels.slice(-currentRange);
    const datasets = currentSeries.map((vals, i) => {
        const sliced = vals.slice(-currentRange);
        return {
            label: getAptName(i),
            data: sliced,
            borderColor: COLORS[i],
            backgroundColor: 'transparent',
            borderWidth: 1.5,
            pointRadius: 0,
            pointHoverRadius: 4,
            tension: 0.3,
            spanGaps: true,
            _origColor: COLORS[i]
        };
    });

    if (chart) chart.destroy();
    const ctx = document.getElementById('trendChart').getContext('2d');
    chart = new Chart(ctx, {
        type: 'line',
        data: { labels, datasets },
        options: {
            responsive: true, maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: '#1a1a1a', titleColor: '#fff',
                    bodyColor: '#ccc', borderColor: '#333', borderWidth: 1,
                    filter: item => item.raw !== null,
                    callbacks: {
                        label: c => c.raw === null ? null : c.dataset.label + ': ' + fp(c.raw)
                    }
                }
            },
            scales: {
                x: { ticks: { color: '#666', maxRotation: 45, maxTicksLimit: 12 }, grid: { color: '#222' } },
                y: { ticks: { color: '#666', callback: v => { const b = Math.floor(v/10000); return b > 0 ? b+'ì–µ' : v.toLocaleString()+'ë§Œ'; } }, grid: { color: '#222' } }
            }
        }
    });

    if (activeIdx >= 0) highlightChart(activeIdx);
}

function getAptName(i) {
    const key = currentSido + '|' + currentDistrict;
    const d = DATA ? DATA.data[key] : null;
    return d && d.top10[i] ? d.top10[i].name : '';
}

function setRange(m) {
    currentRange = m;
    document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(m===12?'btn-1y':m===24?'btn-2y':'btn-3y').classList.add('active');
    renderChart();
}

/* â”€â”€ í…Œì´ë¸” â”€â”€ */
function renderTable(d) {
    const tbody = document.getElementById('tableBody');
    if (!d || !d.top10.length) {
        tbody.innerHTML = '<tr><td colspan="4" class="empty-msg">í•´ë‹¹ ì§€ì—­ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
        return;
    }
    let html = '';
    d.top10.forEach((apt, i) => {
        const c = COLORS[i];
        html += `<tr class="main-row" data-idx="${i}" onclick="handleRowClick(${i})">
            <td class="rank-cell">${i+1}</td>
            <td class="apt-name"><span class="color-dot" style="background:${c}"></span>${apt.name} <span class="arrow" id="arrow-${i}">â–¼</span></td>
            <td class="loc-cell">${apt.dong}</td>
            <td class="price">${fp(apt.ppyeong)}</td>
        </tr>
        <tr class="detail-row" id="detail-${i}"><td colspan="4"><div class="detail-content"><div class="detail-info"><table class="detail-table">
            <tr><th>ì „ìš©ë©´ì </th><td>${apt.area_m2}ã¡ (${apt.area_pyeong}í‰)</td></tr>
            <tr><th>ê±°ë˜ê¸ˆì•¡</th><td>${fp_full(apt.price)}</td></tr>
            <tr><th>ê±°ë˜ì¼</th><td>${apt.date}</td></tr>
            <tr><th>ì¸µ</th><td>${apt.floor}ì¸µ</td></tr>
            <tr><th>ê±´ì¶•ë…„ë„</th><td>${apt.build_year}ë…„</td></tr>
        </table></div></div></td></tr>`;
    });
    tbody.innerHTML = html;
}

function fp_full(p) {
    const b = p / 10000;
    if (b >= 1) return b === Math.floor(b) ? Math.floor(b) + 'ì–µ' : b.toFixed(1) + 'ì–µ';
    return p.toLocaleString() + 'ë§Œ';
}

/* â”€â”€ í´ë¦­ ì¸í„°ë™ì…˜ â”€â”€ */
function highlightChart(idx) {
    if (!chart) return;
    const label = document.getElementById('selectedLabel');
    chart.data.datasets.forEach((ds, i) => {
        if (i === idx) {
            ds.borderWidth = 3.5; ds.borderColor = ds._origColor;
            ds.pointRadius = 3; ds.pointBackgroundColor = ds._origColor;
        } else {
            ds.borderWidth = 1; ds.borderColor = ds._origColor + '1A'; ds.pointRadius = 0;
        }
    });
    label.textContent = getAptName(idx);
    label.style.color = COLORS[idx];
    label.classList.add('show');
    chart.update();
}

function resetChart() {
    if (!chart) return;
    const label = document.getElementById('selectedLabel');
    chart.data.datasets.forEach(ds => {
        ds.borderWidth = 1.5; ds.borderColor = ds._origColor; ds.pointRadius = 0;
    });
    label.classList.remove('show');
    chart.update();
}

function highlightRows(idx) {
    document.querySelectorAll('.main-row').forEach((row, i) => {
        if (i === idx) { row.classList.add('active-row'); row.classList.remove('dimmed'); }
        else { row.classList.remove('active-row'); row.classList.add('dimmed'); }
    });
}

function resetRows() {
    document.querySelectorAll('.main-row').forEach(row => row.classList.remove('active-row','dimmed'));
}

function handleRowClick(idx) {
    if (activeIdx === idx) {
        activeIdx = -1; resetChart(); resetRows();
    } else {
        activeIdx = idx; highlightChart(idx); highlightRows(idx);
        document.getElementById('chartSection').scrollIntoView({ behavior:'smooth', block:'nearest' });
    }
    const det = document.getElementById('detail-'+idx);
    const arr = document.getElementById('arrow-'+idx);
    if (det) det.classList.toggle('show');
    if (arr) arr.classList.toggle('open');
}

/* â”€â”€ ìƒ˜í”Œ ë°ì´í„° (JSON ì—†ì„ ë•Œ) â”€â”€ */
function genSample() {
    function line(base, seed) {
        const a = []; let v = base, s = seed;
        for (let i = 0; i < 36; i++) {
            s = (s * 9301 + 49297) % 233280;
            v += Math.round((s/233280 - 0.38) * 500);
            a.push(s/233280 > 0.9 ? null : v);
        }
        return a;
    }
    const labels = [];
    for (let y = 2023; y <= 2026; y++)
        for (let m = 1; m <= 12; m++) {
            const l = y+'.'+String(m).padStart(2,'0');
            if (labels.length < 36) labels.push(l);
        }
    const sample = {
        "ì„œìš¸ì‹œ|ê°•ë‚¨êµ¬": { avg:28500, deals:245, top10:[
            {name:"ë”íœíŠ¸í•˜ìš°ìŠ¤ì²­ë‹´",dong:"ì²­ë‹´ë™",area_m2:222.86,area_pyeong:67.5,price:1920000,ppyeong:28500,date:"2025.11.28",floor:"15",build_year:"2015"},
            {name:"ë„ê³¡ë ‰ìŠ¬",dong:"ë„ê³¡ë™",area_m2:84.99,area_pyeong:25.8,price:575000,ppyeong:22300,date:"2025.11.25",floor:"18",build_year:"2003"},
            {name:"íƒ€ì›ŒíŒ°ë¦¬ìŠ¤3ì°¨",dong:"ë„ê³¡ë™",area_m2:163.23,area_pyeong:49.5,price:1030000,ppyeong:20800,date:"2025.10.15",floor:"55",build_year:"2004"},
            {name:"ë˜ë¯¸ì•ˆëŒ€ì¹˜íŒ°ë¦¬ìŠ¤",dong:"ëŒ€ì¹˜ë™",area_m2:84.98,area_pyeong:25.7,price:510000,ppyeong:19800,date:"2025.11.22",floor:"16",build_year:"2015"},
            {name:"ì€ë§ˆì•„íŒŒíŠ¸",dong:"ëŒ€ì¹˜ë™",area_m2:84.43,area_pyeong:25.6,price:492000,ppyeong:19200,date:"2025.12.12",floor:"8",build_year:"1979"},
            {name:"ê°œí¬ìì´í”„ë ˆì§€ë˜ìŠ¤",dong:"ê°œí¬ë™",area_m2:84.98,area_pyeong:25.7,price:480000,ppyeong:18600,date:"2025.10.08",floor:"22",build_year:"2021"},
            {name:"ë””ì—ì´ì¹˜ìì´ê°œí¬",dong:"ê°œí¬ë™",area_m2:84.97,area_pyeong:25.7,price:465000,ppyeong:18100,date:"2025.11.05",floor:"19",build_year:"2021"},
            {name:"ëŒ€ì¹˜SKë·°",dong:"ëŒ€ì¹˜ë™",area_m2:84.99,area_pyeong:25.8,price:450000,ppyeong:17400,date:"2025.12.01",floor:"14",build_year:"2018"},
            {name:"ë˜ë¯¸ì•ˆë¸”ë ˆìŠ¤í‹°ì§€",dong:"ê°œí¬ë™",area_m2:84.98,area_pyeong:25.7,price:440000,ppyeong:17100,date:"2025.10.20",floor:"11",build_year:"2019"},
            {name:"ì‚¼ì„±ë˜ë¯¸ì•ˆ",dong:"ëŒ€ì¹˜ë™",area_m2:84.97,area_pyeong:25.7,price:425000,ppyeong:16500,date:"2025.11.15",floor:"9",build_year:"2009"}
        ], series: Array.from({length:10},(_,i)=>line(28000-i*1200, (i+1)*137))},
        "ì„œìš¸ì‹œ|ì„œì´ˆêµ¬": { avg:26800, deals:198, top10:[
            {name:"ì•„í¬ë¡œë¦¬ë²„íŒŒí¬",dong:"ë°˜í¬ë™",area_m2:84.98,area_pyeong:25.7,price:850000,ppyeong:33074,date:"2026.01.15",floor:"25",build_year:"2016"},
            {name:"ë˜ë¯¸ì•ˆì›ë² ì¼ë¦¬",dong:"ë°˜í¬ë™",area_m2:84.99,area_pyeong:25.8,price:810000,ppyeong:31500,date:"2026.01.10",floor:"32",build_year:"2024"},
            {name:"ë˜ë¯¸ì•ˆí¼ìŠ¤í‹°ì§€",dong:"ë°˜í¬ë™",area_m2:84.97,area_pyeong:25.7,price:653000,ppyeong:25400,date:"2025.12.18",floor:"21",build_year:"2009"},
            {name:"ë°˜í¬ìì´",dong:"ë°˜í¬ë™",area_m2:84.94,area_pyeong:25.7,price:638000,ppyeong:24800,date:"2025.10.22",floor:"15",build_year:"2009"},
            {name:"ë°˜í¬ë˜ë¯¸ì•ˆì•„ì´íŒŒí¬",dong:"ë°˜í¬ë™",area_m2:59.96,area_pyeong:18.2,price:355000,ppyeong:19500,date:"2025.10.28",floor:"12",build_year:"2018"},
            {name:"ì ì›ë˜ë¯¸ì•ˆ",dong:"ì ì›ë™",area_m2:84.97,area_pyeong:25.7,price:480000,ppyeong:18600,date:"2025.11.10",floor:"10",build_year:"2010"},
            {name:"ì„œì´ˆê·¸ë‘ìì´",dong:"ì„œì´ˆë™",area_m2:84.98,area_pyeong:25.7,price:465000,ppyeong:18100,date:"2025.12.02",floor:"18",build_year:"2021"},
            {name:"ë˜ë¯¸ì•ˆì„œì´ˆì—ìŠ¤í‹°ì§€",dong:"ì„œì´ˆë™",area_m2:84.99,area_pyeong:25.8,price:450000,ppyeong:17400,date:"2025.10.05",floor:"15",build_year:"2020"},
            {name:"ì•„í¬ë¡œë¹„ìŠ¤íƒ€",dong:"ë°˜í¬ë™",area_m2:84.97,area_pyeong:25.7,price:435000,ppyeong:16900,date:"2025.11.20",floor:"7",build_year:"2007"},
            {name:"ë˜ë¯¸ì•ˆë¦¬ë”ìŠ¤ì›",dong:"ì„œì´ˆë™",area_m2:84.98,area_pyeong:25.7,price:420000,ppyeong:16300,date:"2025.12.08",floor:"20",build_year:"2019"}
        ], series: Array.from({length:10},(_,i)=>line(32000-i*1800, (i+3)*97))}
    };
    return { updated:"ìƒ˜í”Œ ë°ì´í„°", labels, data:sample };
}

/* â”€â”€ ì´ˆê¸°í™” â”€â”€ */
async function init() {
    buildTabs();
    populateDropdown();
    try {
        const resp = await fetch('data/district_top10.json');
        if (resp.ok) {
            DATA = await resp.json();
            document.getElementById('footerText').textContent =
                'ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ' + DATA.updated + ' Â· ë°ì´í„° ì¶œì²˜: êµ­í† êµí†µë¶€ ì‹¤ê±°ë˜ê°€ ê³µê°œì‹œìŠ¤í…œ';
        } else throw new Error();
    } catch(e) {
        DATA = genSample();
        document.getElementById('footerText').textContent =
            'âš ï¸ ìƒ˜í”Œ ë°ì´í„° í‘œì‹œ ì¤‘ Â· ì‹¤ì œ ë°ì´í„°ëŠ” GitHub Actions ì‹¤í–‰ í›„ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤';
    }
    render();
}

init();
</script>
</body>
</html>
